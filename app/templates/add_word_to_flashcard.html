{% extends "base.html" %}

{% block title %}{{ flashcard.name }} - Kelime Ekle{% endblock %}

{% block extra_css %}
<style>
/* Method Selection Cards */
.method-card {
    border: 2px solid #e9ecef;
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    min-height: 280px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.method-card:hover {
    border-color: #667eea;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    transform: translateY(-5px);
}

.method-card.selected {
    border-color: #667eea;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.method-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    color: #667eea;
    transition: color 0.3s ease;
}

.method-card.selected .method-icon {
    color: white;
}

.method-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
}

.method-description {
    font-size: 1rem;
    opacity: 0.8;
    line-height: 1.5;
}

/* Form Sections */
.form-section {
    display: none;
}

.form-section.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* File Upload Area */
.file-upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 12px;
    padding: 1.5rem 1rem;
    text-align: center;
    transition: all 0.3s ease;
    background-color: #f8f9fa;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.file-upload-area:hover {
    border-color: #667eea;
    background-color: rgba(102, 126, 234, 0.05);
}

.file-upload-area.dragover {
    border-color: #667eea;
    background-color: rgba(102, 126, 234, 0.1);
    transform: scale(1.02);
}

.upload-icon {
    font-size: 3rem;
    color: #6c757d;
    margin-bottom: 1rem;
}

.file-upload-area:hover .upload-icon,
.file-upload-area.dragover .upload-icon {
    color: #667eea;
}

/* Back Button */
.back-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 1000;
}

/* Progress Steps */
.progress-steps {
    display: flex;
    justify-content: center;
    margin-bottom: 3rem;
}

.step {
    display: flex;
    align-items: center;
    position: relative;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e9ecef;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    margin-right: 1rem;
    transition: all 0.3s ease;
}

.step.active .step-number {
    background: #667eea;
    color: white;
}

.step.completed .step-number {
    background: #28a745;
    color: white;
}

.step-line {
    width: 80px;
    height: 2px;
    background: #e9ecef;
    margin: 0 1rem;
}

.step.completed .step-line {
    background: #28a745;
}

/* Format Examples */
.format-example {
    background: #f8f9fa;
    border-radius: 6px;
    padding: 0.5rem;
    margin-top: 0.25rem;
    font-family: 'Courier New', monospace;
    font-size: 0.7rem;
    line-height: 1.2;
}

/* Ensure format examples stay visible - completely disable all animations */
.format-examples-container {
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
    animation: none !important;
    transition: none !important;
    animation-duration: 0s !important;
    animation-delay: 0s !important;
    animation-iteration-count: 0 !important;
}

/* Override any inherited animations on format examples */
.format-examples-container * {
    animation: none !important;
    transition: none !important;
    animation-duration: 0s !important;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 pt-4 position-relative">
    <!-- Back Button -->
    <div class="back-btn">
        <a href="/flashcard/{{ flashcard.id }}/detail" class="btn btn-outline-secondary rounded-circle" title="Geri Dön">
            <i class="fas fa-arrow-left"></i>
        </a>
    </div>

    <!-- Header Section -->
    <div class="row mb-3">
        <div class="col-12 text-center">
            <h1 class="h3 fw-bold mb-2" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                <i class="fas fa-plus-circle me-2"></i>Kelime Ekleme
            </h1>
            <p class="text-muted mb-2">{{ flashcard.name }} flashcard'ına kelime eklemek için bir yöntem seçin</p>
            
            <!-- Flashcard Info Badge -->
            <div class="d-inline-block">
                <span class="badge bg-light text-dark px-3 py-1 rounded-pill">
                    <i class="fas fa-language me-1"></i>
                    {{ flashcard.front_language|upper }} → {{ flashcard.back_language|upper }}
                </span>
            </div>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps mb-3">
        <div class="step active" id="step1">
            <div class="step-number">1</div>
            <span>Yöntem Seç</span>
        </div>
        <div class="step-line"></div>
        <div class="step" id="step2">
            <div class="step-number">2</div>
            <span>Kelime Ekle</span>
        </div>
        <div class="step-line"></div>
        <div class="step" id="step3">
            <div class="step-number">3</div>
            <span>Tamamla</span>
        </div>
    </div>

    <!-- Flash Messages are now handled by base.html to avoid duplication -->

    <!-- Existing Word Found Alert -->
    {% if existing_word %}
    <div class="alert alert-info alert-persistent border-0 shadow-sm" style="border-radius: 15px; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);">
        <div class="d-flex align-items-center mb-3">
            <div class="me-3">
                <i class="fas fa-info-circle fa-2x" style="color: #1976d2;"></i>
            </div>
            <div>
                <h5 class="mb-1 fw-bold" style="color: #1976d2;">
                    <i class="fas fa-search me-2"></i>
                    {% if different_meaning %}
                        Kelime Farklı Anlamla Mevcut!
                    {% else %}
                        Kelime Zaten Mevcut!
                    {% endif %}
                </h5>
                <p class="mb-0 text-muted">
                    {% if different_meaning %}
                        "{{ searched_front_word }}" kelimesi zaten kayıtlı ama farklı bir anlamla. Mevcut anlamı güncellemeyi veya yeni anlamla ayrı bir giriş eklemeyi seçebilirsiniz.
                    {% else %}
                        Aradığınız kelime bu flashcard'da zaten kayıtlı. Mevcut anlamı görüntüleyebilir veya güncelleyebilirsiniz.
                    {% endif %}
                </p>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card border-0" style="background: rgba(255, 255, 255, 0.7); border-radius: 12px;">
                    <div class="card-body p-3">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="text-center p-2">
                                    <small class="text-muted fw-bold d-block mb-1">{{ flashcard.front_language|upper }} KELİME</small>
                                    <span class="h5 fw-bold" style="color: #1976d2;">{{ existing_word.word }}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-center p-2">
                                    <small class="text-muted fw-bold d-block mb-1">{{ flashcard.back_language|upper }} ANLAM</small>
                                    <span class="h5 fw-bold" style="color: #7b1fa2;">{{ existing_word.answer }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="d-flex flex-column gap-2">
                    {% if different_meaning %}
                        <button class="btn btn-outline-success btn-sm" onclick="keepExisting()" style="border-radius: 8px;">
                            <i class="fas fa-check me-1"></i>Mevcut Anlamı Koru
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="showUpdateForm()" style="border-radius: 8px;">
                            <i class="fas fa-edit me-1"></i>Mevcut Anlamı Güncelle
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="showAddNewMeaningForm()" style="border-radius: 8px;">
                            <i class="fas fa-plus me-1"></i>Yeni Anlamla Ekle
                        </button>
                    {% else %}
                        <button class="btn btn-outline-success btn-sm" onclick="keepExisting()" style="border-radius: 8px;">
                            <i class="fas fa-check me-1"></i>Bu Anlamı Koru
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="showUpdateForm()" style="border-radius: 8px;">
                            <i class="fas fa-edit me-1"></i>Anlamı Güncelle
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Update Form (Hidden by default) -->
        <div id="updateForm" class="mt-3" style="display: none;">
            <div class="card border-0" style="background: rgba(255, 255, 255, 0.9); border-radius: 12px;">
                <div class="card-body p-3">
                    <h6 class="fw-bold mb-2 text-warning">
                        <i class="fas fa-edit me-1"></i>Mevcut Anlamı Güncelle
                    </h6>
                    <form method="POST" action="/flashcard/{{ flashcard.id }}/words/update/{{ existing_word.id }}">
                        <div class="row align-items-end">
                            <div class="col-md-8">
                                <label for="new_back_word" class="form-label fw-semibold small">
                                    <i class="fas fa-language me-1"></i>Yeni {{ flashcard.back_language|upper }} Anlamı
                                </label>
                                <input type="text" class="form-control" id="new_back_word" name="new_back_word" 
                                       placeholder="Yeni anlamı girin..." value="{{ searched_back_word or '' }}"
                                       style="border-radius: 8px;">
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn-success btn-sm flex-fill">
                                        <i class="fas fa-save me-1"></i>Güncelle
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="hideUpdateForm()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        {% if different_meaning %}
        <!-- Add New Meaning Form (Hidden by default) -->
        <div id="addNewMeaningForm" class="mt-3" style="display: none;">
            <div class="card border-0" style="background: rgba(255, 255, 255, 0.9); border-radius: 12px;">
                <div class="card-body p-3">
                    <h6 class="fw-bold mb-2 text-primary">
                        <i class="fas fa-plus me-1"></i>Yeni Anlamla Ayrı Giriş Ekle
                    </h6>
                    <form method="POST" action="/flashcard/{{ flashcard.id }}/words/add/new-meaning">
                        <input type="hidden" name="front_word" value="{{ searched_front_word }}">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold small">
                                    <i class="fas fa-language me-1"></i>{{ flashcard.front_language|upper }} Kelime
                                </label>
                                <input type="text" class="form-control" value="{{ searched_front_word }}" readonly
                                       style="border-radius: 8px; background-color: #f8f9fa;">
                            </div>
                            <div class="col-md-6">
                                <label for="new_meaning_back_word" class="form-label fw-semibold small">
                                    <i class="fas fa-language me-1"></i>{{ flashcard.back_language|upper }} Anlamı
                                </label>
                                <input type="text" class="form-control" id="new_meaning_back_word" name="back_word" 
                                       placeholder="Yeni anlamı girin..." value="{{ searched_back_word or '' }}"
                                       style="border-radius: 8px;" required>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-12">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <label for="new_meaning_example_sentence" class="form-label fw-semibold small mb-0">
                                        <i class="fas fa-quote-left me-1"></i>Örnek Cümle
                                    </label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="new_meaning_auto_fill_example" name="auto_fill_example">
                                        <label class="form-check-label small text-muted" for="new_meaning_auto_fill_example">
                                            <i class="fas fa-robot me-1"></i>Otomatik oluştur
                                        </label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="new_meaning_example_sentence" name="example_sentence" 
                                          placeholder="Kelimeyi içeren örnek bir cümle yazın..."
                                          rows="2" style="border-radius: 8px; resize: vertical;"></textarea>
                            </div>
                        </div>
                        <div class="row mt-2 align-items-end">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold small">Zorluk</label>
                                <select class="form-select form-select-sm" name="difficulty" style="border-radius: 8px;">
                                    <option value="easy">Kolay</option>
                                    <option value="medium" selected>Orta</option>
                                    <option value="hard">Zor</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn-primary btn-sm flex-fill">
                                        <i class="fas fa-plus me-1"></i>Ekle
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="hideAddNewMeaningForm()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Method Selection -->
    <div class="method-selection" id="methodSelection">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="row g-4">
                    <!-- Single Word Entry -->
                    <div class="col-md-6">
                        <div class="method-card" data-method="single" onclick="selectMethod('single')">
                            <div class="method-icon">
                                <i class="fas fa-keyboard"></i>
                            </div>
                            <h3 class="method-title">Tek Tek Girme</h3>
                            <p class="method-description">
                                Kelimeleri tek tek manuel olarak girin.<br>
                                Her kelime için ayrı ayrı form doldurun.
                            </p>
                            <div class="mt-3">
                                <small class="opacity-75">✓ Kolay ve hızlı</small><br>
                                <small class="opacity-75">✓ Kontrollü ekleme</small>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk File Upload -->
                    <div class="col-md-6">
                        <div class="method-card" data-method="bulk" onclick="selectMethod('bulk')">
                            <div class="method-icon">
                                <i class="fas fa-file-upload"></i>
                            </div>
                            <h3 class="method-title">Dosya Yükleme</h3>
                            <p class="method-description">
                                Excel, CSV veya TXT dosyası ile<br>
                                toplu kelime yükleyin.
                            </p>
                            <div class="mt-3">
                                <small class="opacity-75">✓ Toplu işlem</small><br>
                                <small class="opacity-75">✓ Zaman tasarrufu</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Continue Button -->
                <div class="row justify-content-center mt-4">
                    <div class="col-auto">
                        <button class="btn btn-primary btn-lg px-5 py-3" id="continueBtn" onclick="continueToForm()" style="display: none; border-radius: 25px;">
                            <i class="fas fa-arrow-right me-2"></i>Devam Et
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Single Word Form -->
    <div class="form-section" id="singleForm">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm" style="border-radius: 20px;">
                    <div class="card-body p-5">
                        <h4 class="fw-bold mb-4 text-center">
                            <i class="fas fa-keyboard me-2" style="color: #667eea;"></i>
                            Tek Kelime Ekleme
                        </h4>

                        <form method="POST" action="/flashcard/{{ flashcard.id }}/words/add/single">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label for="front_word" class="form-label fw-semibold">
                                        <i class="fas fa-language me-2"></i>{{ flashcard.front_language|upper }} Kelime
                                    </label>
                                    <input type="text" class="form-control form-control-lg" id="front_word" name="front_word" 
                                           placeholder="{{ flashcard.front_language|upper }} kelimeyi girin..." required
                                           style="border-radius: 12px; border: 2px solid #e9ecef;">
                                </div>
                                <div class="col-md-6">
                                    <label for="back_word" class="form-label fw-semibold">
                                        <i class="fas fa-language me-2"></i>{{ flashcard.back_language|upper }} Anlamı
                                    </label>
                                    <input type="text" class="form-control form-control-lg" id="back_word" name="back_word" 
                                           placeholder="{{ flashcard.back_language|upper }} anlamını girin..." required
                                           style="border-radius: 12px; border: 2px solid #e9ecef;">
                                </div>
                                <div class="col-12">
                                    <label for="difficulty" class="form-label fw-semibold">
                                        <i class="fas fa-chart-bar me-2"></i>Zorluk Seviyesi
                                    </label>
                                    <select class="form-select form-select-lg" id="difficulty" name="difficulty" 
                                            style="border-radius: 12px; border: 2px solid #e9ecef;">
                                        <option value="easy">Kolay</option>
                                        <option value="medium" selected>Orta</option>
                                        <option value="hard">Zor</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                        <label for="example_sentence" class="form-label fw-semibold mb-0">
                                            <i class="fas fa-quote-left me-2"></i>Örnek Cümle
                                        </label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="auto_fill_example" name="auto_fill_example">
                                            <label class="form-check-label small text-muted" for="auto_fill_example">
                                                <i class="fas fa-robot me-1"></i>Otomatik oluştur
                                            </label>
                                        </div>
                                    </div>
                                    <textarea class="form-control form-control-lg" id="example_sentence" name="example_sentence" 
                                              placeholder="Kelimeyi içeren örnek bir cümle yazın (veya otomatik oluşturmak için yukarıdaki kutuyu işaretleyin)..."
                                              rows="3" style="border-radius: 12px; border: 2px solid #e9ecef; resize: vertical;"></textarea>
                                    <small class="text-muted mt-1">
                                        <i class="fas fa-info-circle me-1"></i>Örnek cümle kelimeyi hatırlamanıza yardımcı olur
                                    </small>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-outline-secondary btn-lg px-4" onclick="goBackToSelection()">
                                    <i class="fas fa-arrow-left me-2"></i>Geri
                                </button>
                                <button type="submit" class="btn btn-success btn-lg px-5">
                                    <i class="fas fa-plus me-2"></i>Kelime Ekle
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Form -->
    <div class="form-section" id="bulkForm">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm" style="border-radius: 20px;">
                    <div class="card-body p-3">
                        <h5 class="fw-bold mb-3 text-center">
                            <i class="fas fa-file-upload me-2" style="color: #667eea;"></i>
                            Toplu Kelime Yükleme
                        </h5>

                        <form method="POST" action="/flashcard/{{ flashcard.id }}/words/add/bulk" enctype="multipart/form-data" id="bulkUploadForm">
                            <!-- File Upload Area -->
                            <div class="file-upload-area" id="fileUploadArea">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h6 class="fw-bold mb-2">Dosyanızı buraya sürükleyin</h6>
                                <p class="text-muted mb-2 small">veya dosya seçmek için tıklayın</p>
                                <input type="file" id="fileInput" name="files" class="d-none" accept=".xlsx,.csv,.txt" multiple>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="document.getElementById('fileInput').click()">
                                    <i class="fas fa-folder-open me-1"></i>Dosya Seç
                                </button>
                                <div class="mt-2">
                                    <small class="text-muted">
                                        Excel (.xlsx), CSV (.csv), Text (.txt)
                                    </small>
                                </div>
                            </div>

                        <!-- Format Examples with Headers -->
                        <div class="format-examples-container mt-2" style="border-radius: 10px; border: 1px solid #e9ecef; background-color: #f8f9fa; padding: 0.75rem;">
                            <h6 class="fw-bold mb-2 text-center small">
                                <i class="fas fa-table me-1" style="color: #667eea;"></i>Dosya Format Örnekleri
                            </h6>
                            
                            <!-- Column Headers -->
                            <div class="mb-1 p-1" style="background: #f1f3f4; border-radius: 6px;">
                                <div class="row text-center small fw-bold text-muted" style="font-size: 0.75rem;">
                                    <div class="col">WORD</div>
                                    <div class="col">ANSWER</div>
                                    <div class="col">FRONT_LANG</div>
                                    <div class="col">BACK_LANG</div>
                                    <div class="col">DIFFICULTY</div>
                                </div>
                                <div class="row text-center small mt-1" style="font-size: 0.7rem;">
                                    <div class="col">{{ flashcard.front_language|upper }} Kelime</div>
                                    <div class="col">{{ flashcard.back_language|upper }} Anlamı</div>
                                    <div class="col">{{ flashcard.front_language }}</div>
                                    <div class="col">{{ flashcard.back_language }}</div>
                                    <div class="col">kolay/orta/zor</div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <h6 class="fw-bold text-success" style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                                        <i class="fas fa-file-excel me-1"></i>Excel
                                    </h6>
                                    <div class="format-example" style="background: #f0fff4;">
<strong>apple</strong> | elma | en | tr | kolay<br>
<strong>car</strong> | araba | en | tr | orta
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="fw-bold text-primary" style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                                        <i class="fas fa-file-csv me-1"></i>CSV
                                    </h6>
                                    <div class="format-example" style="background: #f0f8ff;">
<strong>apple</strong>,elma,en,tr,kolay<br>
<strong>car</strong>,araba,en,tr,orta
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="fw-bold text-warning" style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                                        <i class="fas fa-file-alt me-1"></i>TXT
                                    </h6>
                                    <div class="format-example" style="background: #fffbf0;">
<strong>apple</strong>&nbsp;&nbsp;&nbsp;elma&nbsp;&nbsp;&nbsp;en&nbsp;&nbsp;&nbsp;tr&nbsp;&nbsp;&nbsp;kolay<br>
<strong>car</strong>&nbsp;&nbsp;&nbsp;araba&nbsp;&nbsp;&nbsp;en&nbsp;&nbsp;&nbsp;tr&nbsp;&nbsp;&nbsp;orta
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Important Notes -->
                        <div class="format-examples-container mt-1" style="border-radius: 8px; background-color: #fff3cd; padding: 0.5rem;">
                            <h6 class="fw-bold mb-1" style="font-size: 0.8rem;">
                                <i class="fas fa-exclamation-triangle me-1"></i>Önemli Notlar
                            </h6>
                            <ul class="mb-0" style="line-height: 1.3; font-size: 0.7rem;">
                                <li><strong>Header yok:</strong> Başlık satırı olmamalı</li>
                                <li><strong>Sütun sırası:</strong> Kelime, Anlamı, Front Dil, Back Dil, Zorluk</li>
                                <li><strong>Duplicate:</strong> Var olan kelimeler atlanacak</li>
                                <li><strong>Dil kodları:</strong> {{ flashcard.front_language }}, {{ flashcard.back_language }}</li>
                            </ul>
                        </div>

                        <!-- Selected Files Display -->
                        <div id="selectedFiles" class="mt-2" style="display: none;"></div>

                            <div class="d-flex justify-content-between mt-2">
                                <button type="button" class="btn btn-outline-secondary px-3" onclick="goBackToSelection()">
                                    <i class="fas fa-arrow-left me-1"></i>Geri
                                </button>
                                <button type="submit" class="btn btn-success px-4" id="uploadBtn" disabled>
                                    <i class="fas fa-upload me-1"></i>Dosyaları Yükle
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let selectedMethod = null;
let selectedFiles = [];

// Method selection
function selectMethod(method) {
    // Remove previous selection
    document.querySelectorAll('.method-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Add selection to clicked card
    document.querySelector(`[data-method="${method}"]`).classList.add('selected');
    
    selectedMethod = method;
    document.getElementById('continueBtn').style.display = 'block';
}

// Continue to form
function continueToForm() {
    if (!selectedMethod) return;
    
    // Update progress steps
    document.getElementById('step1').classList.add('completed');
    document.getElementById('step1').classList.remove('active');
    document.getElementById('step2').classList.add('active');
    
    // Hide method selection
    document.getElementById('methodSelection').style.display = 'none';
    
    // Show appropriate form
    if (selectedMethod === 'single') {
        document.getElementById('singleForm').classList.add('active');
        // Focus on first input
        setTimeout(() => {
            document.getElementById('front_word').focus();
        }, 100);
    } else if (selectedMethod === 'bulk') {
        document.getElementById('bulkForm').classList.add('active');
        setupFileUpload();
    }
}

// Go back to method selection
function goBackToSelection() {
    // Reset progress steps
    document.getElementById('step1').classList.remove('completed');
    document.getElementById('step1').classList.add('active');
    document.getElementById('step2').classList.remove('active');
    
    // Hide forms
    document.querySelectorAll('.form-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Show method selection
    document.getElementById('methodSelection').style.display = 'block';
}

// File upload setup
function setupFileUpload() {
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('fileInput');
    
    // Drag and drop events
    fileUploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
    });
    
    fileUploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
    });
    
    fileUploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        
        const files = Array.from(e.dataTransfer.files);
        handleFiles(files);
    });
    
    // File input change
    fileInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        handleFiles(files);
    });
    
    // Click to upload
    fileUploadArea.addEventListener('click', () => {
        fileInput.click();
    });
}

// Handle selected files
function handleFiles(files) {
    const validFiles = files.filter(file => {
        const extension = file.name.split('.').pop().toLowerCase();
        return ['xlsx', 'csv', 'txt'].includes(extension);
    });
    
    if (validFiles.length === 0) {
        alert('Lütfen desteklenen formatlardan birini seçin (.xlsx, .csv, .txt)');
        return;
    }
    
    // Dosyaları gerçek input'a ata
    const fileInput = document.getElementById('fileInput');
    const dataTransfer = new DataTransfer();
    
    validFiles.forEach(file => {
        dataTransfer.items.add(file);
    });
    
    fileInput.files = dataTransfer.files;
    selectedFiles = validFiles;
    
    displaySelectedFiles();
    document.getElementById('uploadBtn').disabled = false;
}

// Display selected files
function displaySelectedFiles() {
    const container = document.getElementById('selectedFiles');
    container.innerHTML = '';
    
    if (selectedFiles.length > 0) {
        container.style.display = 'block';
        
        const title = document.createElement('h6');
        title.className = 'fw-bold mb-3';
        title.innerHTML = '<i class="fas fa-file-check me-2"></i>Seçilen Dosyalar:';
        container.appendChild(title);
        
        selectedFiles.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'alert alert-success d-flex justify-content-between align-items-center';
            fileItem.style.borderRadius = '10px';
            fileItem.innerHTML = `
                <div>
                    <i class="fas fa-file me-2"></i>
                    <strong>${file.name}</strong>
                    <small class="text-muted ms-2">(${(file.size / 1024).toFixed(1)} KB)</small>
                </div>
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFile(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(fileItem);
        });
    } else {
        container.style.display = 'none';
    }
}

// Remove file
function removeFile(index) {
    selectedFiles.splice(index, 1);
    displaySelectedFiles();
    
    if (selectedFiles.length === 0) {
        document.getElementById('uploadBtn').disabled = true;
    }
}

// Existing word functions
function keepExisting() {
    // Simply reload the page to go back to the normal add form
    window.location.href = `/flashcard/{{ flashcard.id }}/words/add`;
}

function showUpdateForm() {
    // Hide other forms first
    const addNewForm = document.getElementById('addNewMeaningForm');
    if (addNewForm) addNewForm.style.display = 'none';
    
    document.getElementById('updateForm').style.display = 'block';
    document.getElementById('new_back_word').focus();
}

function hideUpdateForm() {
    document.getElementById('updateForm').style.display = 'none';
}

function showAddNewMeaningForm() {
    // Hide other forms first
    const updateForm = document.getElementById('updateForm');
    if (updateForm) updateForm.style.display = 'none';
    
    document.getElementById('addNewMeaningForm').style.display = 'block';
    document.getElementById('new_meaning_back_word').focus();
}

function hideAddNewMeaningForm() {
    document.getElementById('addNewMeaningForm').style.display = 'none';
}


// Auto-resize textareas
document.addEventListener('DOMContentLoaded', function() {
    // Focus animation for inputs
    document.querySelectorAll('.form-control').forEach(input => {
        input.addEventListener('focus', function() {
            this.style.borderColor = '#667eea';
            this.style.boxShadow = '0 0 0 4px rgba(102, 126, 234, 0.1)';
        });
        
        input.addEventListener('blur', function() {
            this.style.borderColor = '#e9ecef';
            this.style.boxShadow = 'none';
        });
    });
    
    // Force format examples to always be visible
    function ensureFormatExamplesVisible() {
        const formatExamples = document.querySelector('.format-examples-container');
        if (formatExamples) {
            formatExamples.style.setProperty('display', 'block', 'important');
            formatExamples.style.setProperty('opacity', '1', 'important');
            formatExamples.style.setProperty('visibility', 'visible', 'important');
            formatExamples.style.setProperty('animation', 'none', 'important');
            formatExamples.style.setProperty('transition', 'none', 'important');
        }
    }
    
    // Run immediately and periodically
    ensureFormatExamplesVisible();
    setInterval(ensureFormatExamplesVisible, 100);
    
    // Override any DOM observers that might hide the content
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' || mutation.type === 'childList') {
                ensureFormatExamplesVisible();
            }
        });
    });
    
    // Start observing
    const formatContainer = document.querySelector('.format-examples-container');
    if (formatContainer) {
        observer.observe(formatContainer, {
            attributes: true,
            childList: true,
            subtree: true,
            attributeOldValue: true
        });
    }
});
</script>
{% endblock %}